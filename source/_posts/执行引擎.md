---
title: 执行引擎
date: 2020-11-10 09:10:35
tags: java基础
categories: 编程
---
## 概述

- 执行引擎是Java虚拟机核心的组成部分之一。
- “虚拟机”是一个相对于“物理机”的概念，这两种机器都有代码执行能力，其区别是物理机的执行引擎是直接建立在处理器、缓存、指令集和操作系统层面上的，而虚拟机的执行引擎则是由软件自行实现的，因此可以不受物理条件制约地定制指令集与执行引擎的结构体系，能够执行那些不被硬件直接支持的指令集格式。
![图1](https://github.com/PayneZh/MarkDownPhotos/raw/master/res/jvm%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E8%AF%A6%E5%9B%BE.jpg)
- JVM的主要任务是负责装载字节码到其内部，但字节码并不能够直接运行在操作系统之上，因为字节码指令并非等价于本地机器指令，它内部包含的仅仅只是一些能够被JVM所识别的字节码指令、符号表，以及其他辅助信息。那么，如果想要让一个Java程序运行起来，执行引擎（Execution Engine）的任务就是将字节码指令解释/编译为对应平台上的本地机器指令才可以。简单来说，JVM中的执行引擎充当了将高级语言翻译为机器语言的译者。

## 执行引擎的工作过程

1. 执行引擎在执行的过程中究竟需要执行什么样的字节码指令完全依赖于PC寄存器。
2. 每当执行完一项指令操作后，PC寄存器就会更新下一条需要被执行的指令地址。
3. 当然方法在执行的过程中，执行引擎有可能会通过存储在局部变量表中的对象引用准确定位到存储在Java堆中的对象实例信息，以及通过对象头中的元数据指针定位到目标对象的类型信息。
![图2](https://github.com/PayneZh/MarkDownPhotos/raw/master/res/jvm%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.jpg)

从外观上来看，所有的Java虚拟机的执行引擎输入、输出都是一致的：输入的是字节码二进制流，处理过程是字节码解析执行的等效过程，输出的是执行结果。

## Java代码编译和执行的过程

![图3](https://github.com/PayneZh/MarkDownPhotos/raw/master/res/jvm%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/%E5%A4%A7%E9%83%A8%E5%88%86%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B.jpg)

大部分的程序代码转换成物理机的目标代码或虚拟机能执行的指令集之前，都需要经过上图中的各个步骤。

Java代码编译是由Java源码编译器来完成，流程图如下所示

![图4](https://github.com/PayneZh/MarkDownPhotos/raw/master/res/jvm%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/java%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%99%A8%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B.jpg)

Java字节码的执行是由JVM执行引擎来完成，流程图如下所示：

![图5](https://github.com/PayneZh/MarkDownPhotos/raw/master/res/jvm%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/jvm%E5%BC%95%E6%93%8E%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B.jpg)

什么是解释器（Interpreter），什么是JIT编译器
解释器：当Java虚拟机启动时会根据预定义的规范对字节码采用逐行解释的方式执行，将每条字节码文件的内容“翻译”为对应平台的本地机器指令执行。
JIT（Just In Time Compiler）编译器：就是虚拟机将源代码直接编译成和本地机器平台相关的机器语言。

为什么说Java是半编译半解释型语言？

JDK1.0时代，将Java语言定位为“解释执行”还是比较准确的。再后来，Java也发展处可以直接生成本地代码的编译器。
现在JVM在执行Java代码的时候，通常都会将解释执行与编译执行二者结合起来进行。